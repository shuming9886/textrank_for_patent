CN108509945A
通过人脸属性识别提升掌静脉识别系统性能的方法

本发明涉及一种通过人脸属性识别提升掌静脉识别系统性能的方法，包括以下步骤：1)人脸图像获取；2)从获取的人脸图像中提取人脸属性，从数据库N个特征值中筛选出符合人脸属性的M个特征值；3)获取掌静脉图像，在M个特征值中进行掌静脉识别；4)输出识别结果。本发明实现了一台硬件系统支持两种生物识别方式，改进点主要集中在大数据量进行比对时待匹配的数据筛选和排序，同等计算机硬件条件下，掌静脉识别处理能力大幅提升，而且不影响现有掌静脉识别技术的识别率，保持了现有技术的技术优势，用户使用体验得到改善。

权利要求书
1.一种通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，包括以下步骤：
1)人脸图像获取；
2)筛选特征值：
从获取的人脸图像中提取人脸属性，从数据库N个特征值中筛选出符合人脸属性的M个特征值；
3)掌静脉识别：
获取掌静脉图像，在M个特征值中进行掌静脉识别；
4)输出识别结果。
2.根据权利要求1所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，还包括人脸识别前的待机步骤：
检测待识别对象到系统的距离是否小于设定的阈值S，所述阈值S为2-5m；
否，则继续待机，是，则进入人脸识别步骤。
3.根据权利要求2所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，所述阈值S为3m。
4.根据权利要求1所述的通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，还包括第二次掌静脉识别的步骤：
当M个特征值中没有匹配信息时，再将获取的掌静脉图像与剩余的(N-M)个特征值进行比对。
5.根据权利要求1至4之任一所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，所述人脸属性具体为：
根据不同的具体人脸属性将目标人群按年龄属性和/或性别属性分段；所述性别属性包括男性和女性；所述年龄属性包括X个年龄段，其中X为非负整数。
6.根据权利要求5所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，所述X＝8。
7.根据权利要求6所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，所述从数据库N个特征值中筛选出符合人脸属性的M个特征值的具体步骤为：
将N中性别相同的特征值排序为第一优先，将N中年龄±5年的特征值排序为第二优先。
8.根据权利要求1至4之任一所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，所述人脸属性具体为：
所述人脸属性为人脸矩形框位置参数和/或人脸关键点坐标数组。
9.根据权利要求8所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，所述输出识别结果的步骤具体为：
根据人脸属性识别结果和/或掌静脉识别结果，输出识别信息。
10.根据权利要求8所述通过人脸属性识别提升掌静脉识别系统性能的方法，其特征在于，所述输出识别结果还包括以下步骤：
利用人脸属性识别的结果作为学习数据帮助掌静脉识别进行机器学习；
或者，
利用掌静脉识别的结果作为学习数据帮助人脸属性识别进行机器学习。

说明书
通过人脸属性识别提升掌静脉识别系统性能的方法
技术领域
本发明涉及一种计算机领域生物识别的方法，尤其涉及一种静脉识别的方法。
背景技术
掌静脉识别技术，是静脉识别的一种，属于生物识别技术，其通过专用摄像头获取手掌静脉的图像，将静脉的数字图像存贮在计算机系统中，并经过特定采集计算方法生成特征值，从而使用特征值进行比对和识别。掌静脉识别技术参考文献：发明名称“手掌静脉摄像装置”，公开号CN105072998A。
掌静脉识别技术的优点有：1、安全性高：属于内生理特征，不会磨损，难以伪造。2、非接触式采集：卫生性好，使用体验佳。3、活体识别：依靠静脉血液流动成像，死人静脉无法成像。4、准确率高：拒真率可达0.01％，认假率可达0.00001％。其中，拒真率是指本人拒绝率FRR，即对张三进行识别，却没有认出张三的概率；识假率是指他人误识率FAR，即对张三进行识别，却把张三认成了李四的概率。
掌静脉识别技术在实际应用中存在的主要问题是：在1:N识别的场景下，即在N个掌静脉特征值中，逐一进行比对，查找输入的1个特征值和N中哪个特征值匹配。该处理过程中，由于比对算法的计算非常复杂，对硬件的性能要求较高。N的数量越大，逐一比对所需的计算量就越大，同样计算机硬件的条件下，所需的时间就越长。掌静脉识别系统1:N识别场景下的一般工作流程，如图1所示。
在相同计算机硬件和软件环境下，N的数量对掌静脉识别效率的影响如表一所示(注：耗时只记录图1工作流程中第5步所需时间，单位：秒)。

表一
表一数据采集的软硬件环境如表二所示：
CPU	Intel Celeron J1900
主频	2.0GHz
核心数	4个
内存	2G
操作系统	Windows7 64位 SP1
硬盘	SSD 32GB固态硬盘
传感器	富士通FAT13M3S1
识别库	富士通SDKV02L02
表二
在表二所示相同计算机软硬件环境下，表一中第4步取出的数据N的数量越大，掌静脉识别系统在第5步进行识别处理所花费的时间越长。
在掌静脉识别系统的实际应用中，因为上述问题的存在，导致一旦遇到大量的掌静脉数据需要进行比对的场景(如1:2000的场景，即在2000个掌静脉特征码中查找匹配的1个特征码)，处理时间要控制在1秒以内的话，对计算机硬件的要求就比较高，随之带来的就是整个掌静脉识别系统的硬件成本会比较高，造成系统整体的效能偏低，使掌静脉识别系统的市场推广应用受到了相应的制约。
如前所述，目前掌静脉识别系统在1:N的场景应用中(即在N个掌静脉特征码中查找匹配1个)，存在识别性能和系统整体效能偏低的问题，当数据量较大的场合，如N大于5000，会直接造成如下影响：
1、识别速度慢，所需时间长，影响用户使用体验。
2、对计算机硬件性能要求高，造成系统成本偏高。
3、长时间高峰值计算处理，造成CPU等芯片散热量大，硬件老化快，系统可靠性稳定性下降。
发明内容
本发明针对掌静脉识别系统应用中产生的问题，经过对系统处理流程的提炼及对大量掌静脉特征值数据的分析，提出一种通过人脸属性识别提升掌静脉识别系统性能的方法。
本发明的技术方案是：
一种通过人脸属性识别提升掌静脉识别系统性能的方法，包括以下步骤：
1)人脸图像获取；
2)筛选特征值：从获取的人脸图像中提取人脸属性，从数据库N个特征值中筛选出符合人脸属性的M个特征值；
3)掌静脉识别：获取掌静脉图像，在M个特征值中进行掌静脉识别；
4)输出识别结果。
为降低功耗，上述方法还包括人脸识别前的待机步骤：检测待识别对象到系统的距离是否小于设定的阈值S，阈值S为2-5m；否，则继续待机，是，则进入人脸识别步骤。
上述方法的阈值S优选3m。
为确保识别效率，上述方法还包括第二次掌静脉识别的步骤：当M个特征值中没有匹配信息时，再将获取的掌静脉图像与剩余的(N-M)个特征值进行比对。
具体的，上述方法中第一种人脸属性具体为：根据不同的具体人脸属性将目标人群按年龄属性和/或性别属性分段；所述性别属性包括男性和女性；所述年龄属性包括X个年龄段，其中X为非负整数。
上述方法中的X优选8。
上述方法中，从数据库N个特征值中筛选出符合人脸属性的M个特征值的具体步骤为：将N中性别相同的特征值排序为第一优先，将N中年龄±5年的特征值排序为第二优先。
具体的，上述方法中第二种人脸属性具体为：所述人脸属性为人脸矩形框位置参数和/或人脸关键点坐标数组。
上述方法中，输出识别结果的步骤具体为：根据人脸属性识别结果和/或掌静脉识别结果，输出识别信息。
上述方法中，输出识别结果还包括以下步骤：利用人脸属性识别的结果作为学习数据帮助掌静脉识别进行机器学习；或者，利用掌静脉识别的结果作为学习数据帮助人脸属性识别进行机器学习。
本发明的有益效果：
1、同等计算机硬件条件下，掌静脉识别处理能力大幅提升，用户使用体验得到改善。
如在表二所示软硬件条件下，使用本发明所提出的方法，进行表一相同处理步骤所耗时间如表三所示(单位：秒)：


表三
经过和表一进行比较，同等硬件条件下性能提升明显，特别是大数据量处理的场合，N值越大，性能提升越明显，参见表四(单位：秒)。
N的数量	现有技术平均耗时	本发明平均耗时	性能提升
10	0.321	0.280	14.5％
1000	0.543	0.408	32.9％
2000	1.185	0.496	139.1％
5000	2.702	0.612	341.8％
表四
处理性能的提升，将大幅改善用户的使用体验。以往在N＝5000的场合，需要将近3秒钟才能完成的掌静脉识别处理，本发明在1秒钟之内即可完成识别，减少识别对象的等待时间，提升了使用的体验。特别是在需要快速认证的场合，如闸机通道、门禁、地铁检票口等，本发明应用价值明显。
2、同等处理能力，硬件成本大幅降低。
采用现有技术，使用表五的较高性能的硬件进行处理速度测试，结果如表六(单位：秒)：
CPU	Intel i5-6600K
主频	3.5GHz
核心数	4个
内存	8G
操作系统	Windows7 64位 SP1
硬盘	SSD 250GB固态硬盘
传感器	FAT13M3S1
识别库	SDKV02L02
表五
N的数量	耗时1	耗时2	耗时3	耗时4	耗时5	平均耗时
10	0.099	0.108	0.084	0.089	0.086	0.093
1000	0.174	0.128	0.140	0.126	0.132	0.140
2000	0.240	0.253	0.304	0.275	0.340	0.282
5000	0.741	0.567	0.570	0.599	0.583	0.612
表六
将表六和表三进行对比发现，在大数据量的情况下，如N＝5000时，两种不同硬件配置的处理能力几乎完全一致，但是硬件成本相差很大，对比结果如表七所示：

表七
由表七可知，本发明只使用了现有技术一半的硬件成本，达到了几乎相同的处理能力。
3、不影响现有掌静脉识别技术的识别率。
本发明的改进点主要集中在大数据量进行比对时待匹配的数据筛选和排序(参考图1第4步处理)，而掌静脉识别本身的识别率，如拒真率、识假率等完全不受影响，保持了现有技术的技术优势。
4、节能降耗、延长设备寿命。
本发明充分发挥了超声波传感器、高清摄像头和掌静脉图像传感器的各自功能，以软件和硬件结构做有机结合，配合切合实际的应用场景，通过超声波模块测试前方物体距离，检测是否存在使用者。在不存在使用者的情况下，液晶显示屏、摄像头等设备进入待机模式(零功耗)；存在使用者的情况下，液晶显示屏、摄像头等设备进入工作模式(正常功耗)。
具体说明如下：
1)识别对象不进入3m(设定的阈值S)区域时，系统为低功耗待机模式。相对于现有技术普遍采用的按照特定时间(如30秒)无操作后进入待机模式，本发明处理更合理、更准确、更智能。
2)识别对象进入3m至1m区域，系统开始工作，进行人脸属性识别处理，此时掌静脉识别系统仍然处于待机状态，两种识别处理不会同时进行，不相互影响，不会产生资源冲突。特别是在系统连接互联网的环境下，人脸属性识别的运算处理都集中在云服务器端，掌静脉识别设备负担很小，仅完成拍照、上传、接收反馈结果的操作，功耗极小。设备在单机运行的情况下，由于人脸属性识别只是对照片的人脸进行性别和年龄的判断，不需要进行比对和识别，对计算机系统的性能要求不高，因此也不会产生较大的功耗。
3)识别对象进入1m区域，人脸属性识别处理已经完成(人步行的速度平均每秒1.38米，2m距离需要时间1.44秒，进行人脸属性识别处理时间充裕)，开始掌静脉识别处理。由于本发明处理性能的大幅提升，处理时间大幅降低，即计算机高速运算的时间减少，随之产生的热量也大幅降低，充分体现了本发明节能降耗的特点。设备工作温度的降低可以延长半导体电子设备的使用寿命，也体现了新技术环保方面的价值。
本发明尤其改善了配备尺寸较大的液晶显示屏计算机生物识别系统的能耗问题。以下列型号系统配置为例：
计算机主板：SNE-J1900K-R2(含CPU、内存、硬盘)；
超声波模块：US-100；
液晶显示屏：G150XTN03.1；
摄像头模块：RER-USBFHD01M；
掌静脉模块：FAT13M3S1。
1)采用该技术之前的功耗为1056W：
(计算机主板24W+超声波模块0.5W+液晶显示屏14W+摄像头模块1W+掌静脉模块4.5W)X 24＝系统24小时整体功耗1056W。
2)采用该技术之后的系统能耗为627W：(24小时中累积高功耗工作时间按照2小时计算)
(计算机主板24W+超声波模块0.5W)X 24+(液晶显示屏14W+摄像头模块1W+掌静脉模块4.5W)X 2＝系统24小时整体功耗627W。
3)由上述计算结果得出结论，采用超声波模块检测前方物体距离，从而控制相关模块待机和工作的技术，可以使得同样硬件配置的系统，在相同的使用场景下的日功耗由1056W下降到627W，能耗降低40％左右。
5、本发明两种识别方式互不影响又可相互为补充。
本发明解决了人脸识别和掌静脉识别的硬件系统集成问题，将两种生物识别方式合理的集成到一台硬件系统中，实现了一台硬件系统支持两种生物识别方式，两种识别方式互不影响又可相互为补充，主要体现在以下两点：
1)两种方式同时识别可以提高系统整体的识别效率。如：只要其中一种识别方式成功识别即可认为识别成功)，这种组合适用于一些对识别速度要求较高的应用场合(如行人入口闸机通道)。如：必须两种识别方式都成功识别才认可为识别成功，这种组合适用于一些对识别准确度要求较高的应用场合(如银行金库)。
2)两种方式同时识别，为互相提高对方的识别率创造了条件。如：可利用人脸识别的结果，作为学习数据，帮助掌静脉识别进行机器学习-有监督学习模式(MachineLearning：supervised learning)，从而提高掌静脉识别的识别率。反之，也可利用掌静脉识别的结果，帮助人脸识别进行机器学习，从而提高人脸识别的识别率。
附图说明
图1是掌静脉识别系统1:N识别场景下的一般工作流程图；
图2是掌静脉识别系统根据识别对象与系统之间的距离进行处理的示意图；
图3是掌静脉识别系统与提供人脸属性识别的云服务器连接的示意图；
图4是掌静脉识别系统的物理结构示意图，其中，1-液晶触控显示屏，2-高清摄像头，3-射频模块，4-超声波距离传感器，5-掌静脉图像传感器；
图5是掌静脉识别系统的内部结构示意图；
图6是本发明方法所对应的软件系统结构示意图；
图7是本发明距离检测处理流程图；
图8是本发明人脸图像拍摄处理流程图；
图9是本发明掌静脉识别处理流程图；
图10是本发明方法所对应的外部电气控制系统和Arduino指令系统处理流程图；
图11是本发明方法各主要模块工作关系及流程图；
图12是微处理器和继电器的线路连接示意图，其中，6-继电器，7-微处理器。
具体实施方式
本发明原理：本发明针对掌静脉识别系统应用中产生的问题，经过对系统处理流程的提炼及对大量掌静脉特征值数据的分析，提出使用人脸属性识别技术，对图1所示掌静脉识别处理流程中的第4步进行优化，用性别属性把待识别对象分为两部分，再用年龄属性把待识别对象分为X个年龄段，其中X为大于1小于100的自然数。性别属性、年龄属性叠加后将目标人群的数量N减少为M，理论上M的数量最小为N的1/2X。例如把年龄段分为8段后，理论上M的数量最小为N的6.25％，可将第4步的处理效能最大提高16倍。
上述理论值基于以下处理条件：
1、性别区分，可将N减少至50％。
2、年龄区分，将年龄划分为8个年龄段，可将N减少至12.5％。
性别与年龄区分条件叠加使用，则可将N减少至6.25％，因此处理效能理论最大提高16倍。
人脸属性识别技术，是人脸识别技术的一种，属于生物识别技术，其通过特定计算方法，从图像中检测人脸信息，并使用人脸属性识别模型，计算出该人脸的性别、年龄、种族等属性信息。该项技术已经相对成熟，实际应用的场景和案例非常多，主要集中在手机、智能设备、安防等领域。人脸属性识别技术参考文献：发明名称“一种自适应的人脸低层特征选择方法及人脸属性识别方法”，公开号CN103824090A。
本发明的技术方案如下：
一、方法流程
如图2所示，掌静脉识别设备上安装有距离感应装置，根据识别对象与掌静脉识别系统之间的距离，进行相应处理：
1)距离3m(阈值S)以上：掌静脉识别系统处于低功耗模式系统待机。
2)距离3m至1m：掌静脉识别系统通过摄像头取得识别对象面部图像，进行人脸属性识别。并根据人脸属性识别结果，从数据库中的N个特征值中筛选出符合相应条件的M个特征值。
3)距离1m以内：掌静脉识别系统等待识别对象放置手掌，一旦获取手掌静脉图像，进入掌静脉识别处理流程，优先逐一比对M个特征值，无匹配的情况下再逐一比对N-M个特征值，最终返回识别结果。
二、系统结构
如图3所示，掌静脉识别系统通过互联网与提供人脸属性识别的云服务器连接，通过上传人脸面部图像，调用云服务器提供的人脸属性分析功能。
考虑到实际应用环境中，存在无法稳定接入互联网的情况，也可以将人脸属性识别功能，集成到掌静脉识别设备上，使整个系统可以单机独立工作。
三、掌静脉识别系统的结构
系统正面结构如图4所示，说明如下：
1)液晶触控显示屏，提供基本的人机交互的输入输出功能。
2)高清摄像头，拍摄人面部数字照片。
3)超声波距离传感器，利用超声波判断系统前方物体(人)的距离。
4)掌静脉图像传感器，利用近红外线成像技术拍摄手掌静脉血管数字图像。
5)射频模块，利用射频模块为系统提供读写射频卡的扩展功能，以便进一步对待识别对象进行识别。
系统内部结构如图5所示，主要模块功能说明如下：
1)X86架构主板：提供承载CPU、硬盘、内存的主要电子线路板，是掌静脉识别系统的计算和处理核心，并提供LAN、电源、串口、USB等外部接口。
2)电源变压器：将220V交流电转换为12V和5V的直流电，为主板供电。
3)摄像头模块：通过USB接口控制摄像头工作并传输图像信息。
4)超声波模块：通过串行口操作超声波发射和接收，并计算和传输距离数据。
5)射频模块：通过串行口操作射频发射和接收，并计算和传输射频卡数据。
6)Arduino微处理器控制模块：通过USB接口操作微处理器，进行数模转换、电平信号输出等操作。
7)继电器：通过接收微处理器电平信号，完成电路打开和关闭的操作，从而控制外部电气设备工作。
掌静脉识别系统中主要元器件型号参数见表八：
名称	型号参数
计算机主板	SNE-J1900K-R2
CPU	Intel Celeron J1900
内存	DDR3 1333 2G
硬盘	32G固态硬盘
液晶触摸显示屏	分辨率：1024*768
摄像头	500万高清摄像头
射频模块	M15
超声波距离传感器	US-100
掌静脉图像传感器	FAT13M3S1
微处理器	Arduino uno R3
继电器	JQC-3FF-S-Z
喇叭	5W立体声喇叭
系统外壳	铝合金边框+钣金后壳
表八
四、软件系统结构
本发明所对应的软件系统的结构如图6所示，主要内容和相互关系说明如下：
1)操作系统采用Windows7。
2)数据库采用windows平台下的通用关系型数据库。
3)基础开发采用.NET Framework平台。
4)距离检测的工作流程参见图7，其负责通过超声波传感器，待识别对象(人)到系统的距离信息。当距离小于3m时，通知UI系统(用户界面系统)，并通过待机和能源管理系统，结束系统待机模式，开始进入工作状态。
5)距离检测系统检测到距离小于3m且大于1m时，通知人脸图像拍摄系统，调用高清摄像头，拍摄识别对象的照片后，储存并发送给人脸属性检测系统。人脸属性检测系统经过对照片的分析，反馈性别、年龄等分析结果。
6)掌静脉识别系统接收到性别和年龄等信息后，在数据库中的N个数据中，筛选出符合条件的M个掌静脉特征码，排序在N的最优先位置，储存在内存中备用。
7)距离检测系统检测到距离小于1m时，通知掌静脉识别系统，使掌静脉图像传感器进入工作状态。
8)当掌静脉图像传感器捕获手掌静脉图像后，掌静脉识别系统将静脉图像生成新的特征值A，并将其逐个在N中进行比对(优先比对M)，查找匹配的特征码，并将匹配成功与否(识别结果)反馈给UI系统，通过液晶屏幕等展示给识别对象(人)。
9)在需要控制外部电气的情况下，掌静脉识别系统会将识别结果通知外部电气控制系统，其通过Arduino微处理器上的指令系统，控制芯片各引脚的信号输出，如通过输出高低电平控制继电器模块，从而达到控制外部电气的目的。Arduino微处理器和继电器的线路连接如图12所示，其中继电器的Vcc端接微处理器电路板的5V直流，其GND端接地，其IN端接微处理器电路板的7号引脚。外部电气控制系统和Arduino指令系统处理流程参见图10。
五、人脸属性检测系统详细说明
参见图8，人脸属性检测系统调用Face++人工智能开放平台提供的人脸识别Detect API(版本3.0)，具体如下：
调用URL：
https://api-cn.faceplusplus.com/facepp/v3/detect
调用方法：
POST
请求参数：

返回值说明：

faces数组中单个元素的结构：


attributes中包含的元素说明：

六、掌静脉识别系统的处理流程和详细说明
图9是本发明掌静脉识别处理流程图，虚线框内的处理通过调用富士通掌静脉识别程序库实现，识别库版本SDKV02L02。
主要函数如下：
1、DNET_BioAPI_ModuleLoad：初始化掌静脉图像传感器。
2、DNET_BioAPI_Identify：拍照、生成图像、转化特征值并在N中进行比对。